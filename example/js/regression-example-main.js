$(function(){

                        var data = [["2014-03-18",0],["2014-03-19",8339],["2014-03-20",9161],["2014-03-21",9795],["2014-03-22",10080],["2014-03-23",10302],["2014-03-24",10639],["2014-03-25",11025],["2014-03-26",11487],["2014-03-27",11840],["2014-03-28",12068],["2014-03-29",12296],["2014-03-30",12400],["2014-03-31",12608],["2014-04-01",12836],["2014-04-02",13089],["2014-04-03",13318],["2014-04-04",13502],["2014-04-05",13633],["2014-04-06",13706],["2014-04-07",13853],["2014-04-08",14005],["2014-04-09",14165],["2014-04-10",14348],["2014-04-11",14521],["2014-04-12",14704],["2014-04-13",14781],["2014-04-14",14915],["2014-04-15",15038],["2014-04-16",15201],["2014-04-17",15421],["2014-04-18",15580],["2014-04-19",15686],["2014-04-20",15755],["2014-04-21",15891],["2014-04-22",16049],["2014-04-23",16174],["2014-04-24",16399],["2014-04-25",16545],["2014-04-26",16616],["2014-04-27",16699],["2014-04-28",16803],["2014-04-29",16935],["2014-04-30",17070],["2014-05-01",17217],["2014-05-02",17367],["2014-05-03",17523],["2014-05-04",17612],["2014-05-05",17765],["2014-05-06",17900],["2014-05-07",18044],["2014-05-08",18172],["2014-05-09",18295],["2014-05-10",18373],["2014-05-11",18435],["2014-05-12",18502],["2014-05-13",18650],["2014-05-14",18786],["2014-05-15",18890],["2014-05-16",19013],["2014-05-17",19082],["2014-05-18",19123],["2014-05-19",19283],["2014-05-20",19400],["2014-05-21",19517],["2014-05-22",19618],["2014-05-23",19701],["2014-05-24",19794],["2014-05-25",19831],["2014-05-26",19908],["2014-05-27",20012],["2014-05-28",20120],["2014-05-29",20237],["2014-05-30",20360],["2014-05-31",20434],["2014-06-01",20492],["2014-06-02",20590],["2014-06-03",20656],["2014-06-04",20739],["2014-06-05",20827],["2014-06-06",20917],["2014-06-07",20965],["2014-06-08",21021],["2014-06-09",21086],["2014-06-10",21220],["2014-06-11",21319],["2014-06-12",21450],["2014-06-13",21546],["2014-06-14",21608],["2014-06-15",21647],["2014-06-16",21723],["2014-06-17",21823],["2014-06-18",21950],["2014-06-19",22056],["2014-06-20",22168],["2014-06-21",22226],["2014-06-22",22274],["2014-06-23",22358],["2014-06-24",22430],["2014-06-25",22515],["2014-06-26",22616],["2014-06-27",22697],["2014-06-28",22778],["2014-06-29",22820],["2014-06-30",22900],["2014-07-01",22981],["2014-07-02",23082],["2014-07-03",23189],["2014-07-04",23275],["2014-07-05",23300],["2014-07-06",23342],["2014-07-07",23463],["2014-07-08",23595],["2014-07-09",23669],["2014-07-10",23767],["2014-07-11",23899],["2014-07-12",23965],["2014-07-13",24027],["2014-07-14",24175],["2014-07-15",24295],["2014-07-16",24297]];

                        var regressionModel = {
                           initialize: function(data) {
                              this.data = data;
                              this.cleanUpData();
                           },

                           cleanUpData: function() {
                              for(var i = 0; i < data.length; i++) {
                                 this.data[i][0] = i + 1;
                              }
                           },

                           getNextYearEndDate: function() {
                              var endDate = this.data[this.data.length-1][0];
                              var momentEndDate = moment(endDate);
                              var momentNextYearProjectedDate = momentEndDate.add("year", 1).format("MM/DD/YYYY");

                              return momentNextYearProjectedDate;
                           },

                           getForecast: function(daysOut) {
                              var yearRelativeToData = data.length + 1 + daysOut;
                              var projectedGtld = this.regression.equation[0] + this.regression.equation[1] * Math.log(yearRelativeToData);

                              return projectedGtld;
                           },

                           getRegression: function(regressionType) {
                              this.regressionType = regressionType;
                              this.regression = regression(regressionType, this.data, 1);
                              return this.regression;
                           },

                           plotResults: function() {
                              $.plot($('.graph'), [
                                 {data: this.regression.points, label: this.regressionType},
                                 {data: this.data, lines: { show: false }, points: { show: true }},
                              ]);
                           },

                           printEquation: function() {
                              $('h2').text(this.regression.string);
                           },

                           printProjectionLabel: function(daysOut) {
                              var momentNextYearProjectedDate = this.getNextYearEndDate();
                              var projectedFigure = this.getForecast(daysOut);

                              $("#projection").html("Projection for " + momentNextYearProjectedDate + ": " + projectedFigure); 
                           }
                        }; 

                        regressionModel.initialize(data);
                        regressionModel.getRegression('logarithmic');
                        
                        regressionModel.plotResults();
                        regressionModel.printEquation();
                        regressionModel.printProjectionLabel(365);
});

